@using MudBlazor
@using ConsulatTermine.UI.Authentication
@using ConsulatTermine.Domain.Enums

@inject NavigationManager Navigation
@inject EmployeeSessionService EmployeeSession

<MudNavMenu>

    @if (_isAuthenticated)
    {
        <!-- ========================= -->
        <!-- EMPLOYEE (ALLE ROLLEN) -->
        <!-- ========================= -->

        <MudNavLink Href="/employee/home" Match="NavLinkMatch.All">
            <MudIcon Icon="@Icons.Material.Filled.Home" />
            <span class="ml-2">Home</span>
        </MudNavLink>

        <MudNavLink Href="/employee/dashboard">
            <MudIcon Icon="@Icons.Material.Filled.Dashboard" />
            <span class="ml-2">Dashboard</span>
        </MudNavLink>

        <MudNavLink Href="/employee/select-service">
            <MudIcon Icon="@Icons.Material.Filled.SwapHoriz" />
            <span class="ml-2">Service wechseln</span>
        </MudNavLink>

        <!-- ========================= -->
        <!-- SERVICE CHEF + ADMIN -->
        <!-- ========================= -->

        @if (_role == EmployeeRole.ServiceChef || _role == EmployeeRole.Admin)
        {
            <MudDivider Class="my-2" />

            <MudNavLink Href="/admin/employees">
                <MudIcon Icon="@Icons.Material.Filled.People" />
                <span class="ml-2">Mitarbeiter</span>
            </MudNavLink>

            <MudNavLink Href="/admin/assignments">
                <MudIcon Icon="@Icons.Material.Filled.Link" />
                <span class="ml-2">Service-Zuweisungen</span>
            </MudNavLink>

            <MudNavLink Href="/admin/working-schedule">
                <MudIcon Icon="@Icons.Material.Filled.Schedule" />
                <span class="ml-2">Arbeitszeiten</span>
            </MudNavLink>
        }

        <!-- ========================= -->
        <!-- ADMIN -->
        <!-- ========================= -->

        @if (_role == EmployeeRole.Admin)
        {
            <MudNavLink Href="/admin/services">
                <MudIcon Icon="@Icons.Material.Filled.BusinessCenter" />
                <span class="ml-2">Services</span>
            </MudNavLink>
        }

        <MudDivider Class="my-2" />

        <!-- ========================= -->
        <!-- LOGOUT -->
        <!-- ========================= -->

        <MudNavLink OnClick="Logout">
            <MudIcon Icon="@Icons.Material.Filled.Logout" />
            <span class="ml-2">Logout</span>
        </MudNavLink>
    }

</MudNavMenu>

@code {
    private bool _isAuthenticated;
    private EmployeeRole? _role;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
            return;

        var auth = await EmployeeSession.EnsureAuthenticatedAsync();
        _isAuthenticated = auth.IsAuthenticated;
        _role = EmployeeSession.CurrentRole;

        StateHasChanged();
    }

    private async Task Logout()
    {
        await EmployeeSession.SignOutAsync();
        Navigation.NavigateTo("/employee/login", replace: true);
    }
}


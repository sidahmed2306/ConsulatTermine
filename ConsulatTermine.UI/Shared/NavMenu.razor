@using MudBlazor
@using ConsulatTermine.UI.Authentication

@inject EmployeeSessionService EmployeeSession
@inject NavigationManager Navigation

<MudNavMenu>

    @if (_isAuthenticated)
    {
        <MudNavLink Href="/employee/home" Match="NavLinkMatch.All">
            <MudIcon Icon="@Icons.Material.Filled.Home" />
            <span class="ml-2">Home</span>
        </MudNavLink>

        <MudNavLink Href="/employee/dashboard">
            <MudIcon Icon="@Icons.Material.Filled.Dashboard" />
            <span class="ml-2">Dashboard</span>
        </MudNavLink>

        <MudNavLink Href="/employee/select-service">
            <MudIcon Icon="@Icons.Material.Filled.SwapHoriz" />
            <span class="ml-2">Service wechseln</span>
        </MudNavLink>

        <MudDivider Class="my-2" />

        <MudNavLink OnClick="Logout">
            <MudIcon Icon="@Icons.Material.Filled.Logout" />
            <span class="ml-2">Logout</span>
        </MudNavLink>
    }
</MudNavMenu>

@code {
    private bool _isAuthenticated;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
            return;

        var result = await EmployeeSession.EnsureAuthenticatedAsync();
        _isAuthenticated = result.IsAuthenticated;

        StateHasChanged();
    }

    private async Task Logout()
    {
        await EmployeeSession.SignOutAsync();
        Navigation.NavigateTo("/employee/login", replace: true);
    }
}
